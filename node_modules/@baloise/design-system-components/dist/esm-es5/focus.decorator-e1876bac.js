import{__awaiter,__extends,__generator}from"tslib";import{L as ListenerAbstract,a as SingleSubject}from"./listener-ea90dc02.js";import{b as balBrowser}from"./browser-9199b5e2.js";import{e as waitAfterIdleCallback,i as isDescendant}from"./helpers-697ce790.js";var BalFocusListener=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.onFocusin=function(t){e.notify({ev:t,isFocusIn:true,isFocusOut:false})};e.onFocusout=function(t){return __awaiter(e,void 0,void 0,(function(){var e;return __generator(this,(function(s){switch(s.label){case 0:return[4,waitAfterIdleCallback()];case 1:s.sent();if(balBrowser.hasDocument&&this.el){e=document.activeElement;if(e&&!isDescendant(this.el,e)){this.notify({ev:t,isFocusIn:false,isFocusOut:true})}}return[2]}}))}))};return e}e.prototype.connect=function(e){t.prototype.connect.call(this,e);if(this.el){this.el.addEventListener("focusin",this.onFocusin);this.el.addEventListener("focusout",this.onFocusout)}};e.prototype.disconnect=function(){t.prototype.disconnect.call(this);if(this.el){this.el.removeEventListener("focusin",this.onFocusin);this.el.removeEventListener("focusout",this.onFocusout)}};return e}(ListenerAbstract);var BalFocusSubject=function(t){__extends(e,t);function e(){var e=t.call(this,(function(t,e){if(e){if(e.isFocusIn){if(t.hasFocus===false){t.focusInListener(e.ev)}t.hasFocus=true}if(e.isFocusOut){t.focusOutListener(e.ev);t.hasFocus=false}}}))||this;e.listener=new BalFocusListener;return e}e.prototype.attach=function(e){var s=this;t.prototype.attach.call(this,e);this.listener.connect(e.el);this.listener.add((function(e){return t.prototype.notify.call(s,e)}))};e.prototype.detach=function(){t.prototype.detach.call(this);this.listener.disconnect()};return e}(SingleSubject);function ListenToFocus(){return function(t,e,s){var n=t.connectedCallback,i=t.disconnectedCallback;t.connectedCallback=function(){if(!this._balFocusSubject){this._balFocusSubject=new BalFocusSubject;this._balFocusSubject.attach(this)}return n&&n.call(this)};t.disconnectedCallback=function(){if(this._balFocusSubject){this._balFocusSubject.detach()}return i&&i.call(this)}}}export{ListenToFocus as L};