import{__awaiter,__extends,__generator}from"tslib";import{r as registerInstance,c as createEvent,h,H as Host,g as getElement}from"./index-853c3f3f.js";import{q as isEscapeKey}from"./index.esm-586fc0cd.js";import{B as BEM}from"./bem-1b28532d.js";import{b as balBrowser}from"./browser-9199b5e2.js";import{s as stopEventBubbling}from"./form-input-8e4d0215.js";import{a as autoUpdate,c as computePosition,s as shift,f as flip,o as offset,b as arrow}from"./floating-ui.dom.esm-fd52c63a.js";import{d as debounce}from"./helpers-697ce790.js";import{L as Logger}from"./log-01623e2c.js";import{focusableQueryString}from"./focus-visible-06bce1ff.js";import"./index-82aff103.js";import"./_commonjsHelpers-ba3f0406.js";import"./icons.constant-0d61e703.js";var AbstractVariantRenderer=function(){function t(){}t.prototype.showContainerElement=function(t){if(t.containerEl){this.showElement(t.containerEl)}};t.prototype.hideContainerElement=function(t){if(t.containerEl){this.hideElement(t.containerEl)}};t.prototype.showArrowElement=function(t,e){if(e===void 0){e=t.arrow}if(e&&t.arrowEl){this.showElement(t.arrowEl)}};t.prototype.hideArrowElement=function(t){if(t.arrowEl){Object.assign(t.arrowEl.style,{left:"",top:"",display:"none",visibility:"hidden"})}};t.prototype.showBackdropElement=function(t,e){if(e===void 0){e=t.backdrop}if(e&&t.backdropEl){this.showElement(t.backdropEl)}};t.prototype.hideBackdropElement=function(t){if(t.backdropEl){this.hideElement(t.backdropEl)}};t.prototype.showElement=function(t){if(t){t.style.setProperty("display","block");t.style.setProperty("visibility","visible")}};t.prototype.hideElement=function(t){if(t){t.style.removeProperty("display");t.style.removeProperty("visibility")}};return t}();var DrawerVariantRenderer=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.backdrop=false;e.offset=0;return e}e.prototype.present=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(t.containerEl&&t.trigger&&t.backdropEl){this.backdrop=t.getBooleanValue(t.trigger,"bal-popup-backdrop",t.backdrop);this.offset=t.getValue(t.trigger,"bal-popup-offset",t.offset);t.containerEl.style.setProperty("inset","auto 0px 0px 0px");t.containerEl.style.setProperty("bottom","".concat(this.offset,"px"));t.backdropEl.style.setProperty("bottom","".concat(this.offset,"px"));this.showBackdropElement(t,this.backdrop);this.showContainerElement(t);return[2,true]}return[2,false]}))}))};e.prototype.update=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,false]}))}))};e.prototype.dismiss=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(t.containerEl&&t.backdropEl){t.balWillAnimate.emit();this.hideBackdropElement(t);this.hideContainerElement(t);t.containerEl.style.removeProperty("inset");t.containerEl.style.removeProperty("bottom");t.backdropEl.style.removeProperty("bottom");return[2,true]}return[2,false]}))}))};return e}(AbstractVariantRenderer);var FullscreenVariantRenderer=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.offset=0;return e}e.prototype.present=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(t.containerEl&&t.trigger){this.offset=t.getValue(t.trigger,"bal-popup-offset",t.offset);t.containerEl.style.setProperty("inset","".concat(this.offset,"px auto auto 0px"));if(this.offset>0){t.containerEl.style.setProperty("box-shadow","inset var(--bal-nav-meta-bar-variant-white-shadow)")}this.showBackdropElement(t);this.showContainerElement(t);this.showArrowElement(t);return[2,true]}return[2,false]}))}))};e.prototype.update=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,false]}))}))};e.prototype.dismiss=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(t.containerEl){this.hideBackdropElement(t);this.hideContainerElement(t);this.hideArrowElement(t);t.containerEl.style.removeProperty("box-shadow");t.containerEl.style.removeProperty("inset");return[2,true]}return[2,false]}))}))};return e}(AbstractVariantRenderer);var PopoverVariantRenderer=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.placement="bottom";e.offset=0;e.arrow=false;e.backdrop=false;e.reference=undefined;e.triggerEl=null;return e}e.prototype.present=function(t){return __awaiter(this,void 0,void 0,(function(){var e,r,i;var n=this;return __generator(this,(function(a){if(!t.trigger&&balBrowser.hasDocument){e=Array.from(document.querySelectorAll('[bal-popup="'.concat(t.el.id,'"]')))[0];t.trigger=e}if(t.trigger&&t.containerEl&&t.arrowEl){this.placement=t.getValue(t.trigger,"bal-popup-placement",t.placement);this.arrow=t.getBooleanValue(t.trigger,"bal-popup-arrow",t.arrow);this.backdrop=t.getBooleanValue(t.trigger,"bal-popup-backdrop",t.backdrop);this.reference=t.getValue(t.trigger,"bal-popup-reference",t.reference);this.offset=t.getNumberValue(t.trigger,"bal-popup-offset",t.offset);this.triggerEl=t.trigger;if(this.reference&&balBrowser.hasDocument){r=document.getElementById(this.reference);this.triggerEl=r?r:t.trigger}if(this.triggerEl){this.showContainerElement(t);this.showBackdropElement(t,this.backdrop);this.showArrowElement(t,this.arrow);this.triggerEl.classList.add("bal-popup-variant-popover-trigger");i=this.placement==="bottom-end"&&this.triggerEl!==t.trigger;if(i){t.setMinWidth(this.triggerEl.clientWidth)}this.cleanup=autoUpdate(this.triggerEl,t.containerEl,(function(){n.update(t)}));return[2,true]}}return[2,false]}))}))};e.prototype.update=function(t){return __awaiter(this,void 0,void 0,(function(){var e,r,i,n,a;return __generator(this,(function(o){if(this.triggerEl&&t.trigger&&t.containerEl&&t.arrowEl){i=this.placement==="bottom-end"&&this.triggerEl!==t.trigger;n=(e=this.triggerEl)===null||e===void 0?void 0:e.getBoundingClientRect();a=(r=t.trigger)===null||r===void 0?void 0:r.getBoundingClientRect();computePosition(this.triggerEl,t.containerEl,{placement:this.placement,middleware:[shift(),flip(),offset(this.arrow?16:this.offset),arrow({element:t.arrowEl,padding:4})]}).then((function(e){var r,o;var s=e.x,l=e.y,p=e.middlewareData,c=e.placement;if(t.containerEl){Object.assign(t.containerEl.style,{left:"".concat(s,"px"),top:"".concat(l,"px")});var u=c.split("-")[0];var d={top:"bottom",right:"left",bottom:"top",left:"right"}[u];if(p.arrow&&t.arrowEl){var h=p.arrow;if(i){var f=n.right-a.right-4;Object.assign(t.arrowEl.style,(r={right:"".concat(f+a.width/2,"px"),left:"",top:l!=null&&h.y!=null?"".concat(h.y,"px"):"",bottom:""},r[d]="".concat(-4,"px"),r))}else{Object.assign(t.arrowEl.style,(o={left:s!=null&&h.x!=null?"".concat(h.x,"px"):"",top:l!=null&&h.y!=null?"".concat(h.y,"px"):"",right:"",bottom:""},o[d]="".concat(-4,"px"),o))}}}}));return[2,true]}return[2,false]}))}))};e.prototype.dismiss=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(t.containerEl&&t.arrowEl&&this.triggerEl){if(this.cleanup){this.cleanup()}this.triggerEl.classList.remove("bal-popup-variant-popover-trigger");this.hideBackdropElement(t);this.hideContainerElement(t);this.hideArrowElement(t);return[2,true]}return[2,false]}))}))};return e}(AbstractVariantRenderer);var VariantRenderer=function(){function t(t){this.renderer=t}t.prototype.present=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:t.balWillAnimate.emit();return[4,this.renderer.present(t)];case 1:e=r.sent();if(e){t.presented=true;t.balDidAnimate.emit()}return[2,e]}}))}))};t.prototype.update=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:t.balWillAnimate.emit();return[4,this.renderer.update(t)];case 1:e=r.sent();if(e){t.balDidAnimate.emit()}return[2,e]}}))}))};t.prototype.dismiss=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:t.balWillAnimate.emit();return[4,this.renderer.dismiss(t)];case 1:e=r.sent();if(e){t.presented=false;t.balDidAnimate.emit()}return[2,e]}}))}))};return t}();var balPopupCss=":root{--bal-popup-backdrop-background:rgba(0,7,57,.8);--bal-popup-container-padding-top:0;--bal-popup-container-padding-bottom:0;--bal-popup-container-background:var(--bal-color-white);--bal-popup-variant-popover-max-width:auto;--bal-popup-variant-popover-radius:var(--bal-radius-large);--bal-popup-variant-popover-shadow:var(--bal-shadow-large);--bal-popup-variant-drawer-radius:var(--bal-radius-large);--bal-popup-arrow-background:var(--bal-color-white)}.bal-popup{position:static;display:inline;z-index:var(--bal-z-index-popup)}.bal-popup__container{background:var(--bal-popup-container-background);display:none;visibility:hidden;padding-top:var(--bal-popup-container-padding-top);padding-bottom:var(--bal-popup-container-padding-bottom);-ms-flex-positive:1;flex-grow:1;margin:0 auto;position:relative;width:auto}.bal-popup__container--variant-popover{border-radius:var(--bal-popup-variant-popover-radius);-webkit-box-shadow:var(--bal-popup-variant-popover-shadow);box-shadow:var(--bal-popup-variant-popover-shadow);width:var(--bal-popup-variant-popover-max-width);position:absolute;top:0;left:0}.bal-popup__container--variant-fullscreen{position:fixed;margin:0;width:100%;min-width:100%;max-width:100% !important;min-height:var(--bal-app-height, 100%);padding-left:var(--bal-container-space);padding-right:var(--bal-container-space)}.bal-popup__container--variant-drawer{position:fixed;border-top-left-radius:var(--bal-popup-variant-drawer-radius);border-top-right-radius:var(--bal-popup-variant-drawer-radius);padding-left:var(--bal-container-space);padding-right:var(--bal-container-space);width:100%}.bal-popup__inner{overflow-y:auto;max-height:calc(var(--bal-app-height, 100%) - 8rem)}.bal-popup__inner__head{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.bal-popup__inner__content{width:100%}.bal-popup__arrow{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;width:8px;height:8px;background:var(--bal-popup-arrow-background);-webkit-transform:rotate(45deg);transform:rotate(45deg);display:none;visibility:hidden}.bal-popup__backdrop{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:fixed;bottom:0;left:0;right:0;top:0;background-color:var(--bal-popup-backdrop-background);width:100vw;display:none;visibility:hidden}.bal-popup-variant-popover-trigger,.bal-popup-permanent-trigger{z-index:calc(var(--bal-z-index-popup) + 1) !important;position:relative !important}";var __decorate=undefined&&undefined.__decorate||function(t,e,r,i){var n=arguments.length,a=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(t,e,r,i);else for(var s=t.length-1;s>=0;s--)if(o=t[s])a=(n<3?o(a):n>3?o(e,r,a):o(e,r))||a;return n>3&&a&&Object.defineProperty(e,r,a),a};var Popup=function(){function t(t){var e=this;registerInstance(this,t);this.balChange=createEvent(this,"balChange",7);this.balWillAnimate=createEvent(this,"balWillAnimate",7);this.balDidAnimate=createEvent(this,"balDidAnimate",7);this.popupId="bal-pu-".concat(popupIds++);this.isClickedOutsideOnMouseDown=false;this.isClickedOutsideOnMouseUp=false;this.popoverVariantRenderer=new VariantRenderer(new PopoverVariantRenderer);this.fullscreenVariantRenderer=new VariantRenderer(new FullscreenVariantRenderer);this.drawerVariantRenderer=new VariantRenderer(new DrawerVariantRenderer);this.lastVariant="popover";this.initialActive=this.active;this.debouncedGlobalClick=debounce((function(t){return e.notifyGlobalClick(t)}),10);this.onBackdropClick=function(t){if(e.activeBackdropDismiss&&e.presented&&t&&t.target){var r=t.target;return r.classList.contains("bal-popup__backdrop")}return false};this.onCloseClick=function(){if(e.activeClosable){e.dismiss()}};this.activeClosable=false;this.activeBackdropDismiss=false;this.activeVariant="popover";this.trigger=undefined;this.lastTrigger=undefined;this.minContainerWidth=0;this.label="";this.reference=undefined;this.variant="popover";this.placement="bottom";this.arrow=false;this.backdrop=false;this.offset=0;this.closable=false;this.backdropDismiss=false;this.active=false;this.presented=false;this.contentWidth=undefined}t.prototype.createLogger=function(t){this.log=t};t.prototype.variantChanged=function(t,e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:if(!(t!==e))return[3,5];return[4,this.getVariantRenderer(e).dismiss(this)];case 1:r.sent();if(!(this.activeVariant!==t))return[3,3];this.lastVariant=this.activeVariant;this.activeVariant=t;return[4,this.getVariantRenderer(this.lastVariant).dismiss(this)];case 2:r.sent();r.label=3;case 3:if(!this.presented)return[3,5];return[4,this.getVariantRenderer(t).present(this)];case 4:r.sent();r.label=5;case 5:return[2]}}))}))};t.prototype.activeChanged=function(t,e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){if(t!==e&&t!==this.presented){if(t){this.present()}else{this.dismiss()}}return[2]}))}))};t.prototype.contentWidthChanged=function(t,e){if(t!==e){if(t===undefined){this.el.style.removeProperty("--bal-popup-variant-popover-max-width")}else{this.el.style.setProperty("--bal-popup-variant-popover-max-width","".concat(this.contentWidth,"px"))}}};t.prototype.componentDidLoad=function(){this.contentWidthChanged(this.contentWidth,0);if(this.initialActive===true&&this.presented!==true){this.present()}};t.prototype.listenOnGlobalClick=function(t){return __awaiter(this,void 0,void 0,(function(){var e,r,i,n;return __generator(this,(function(a){r=t.target;i=r.closest("[bal-popup]");if(i&&balBrowser.hasWindow){n=((e=i.attributes.getNamedItem("bal-popup"))===null||e===void 0?void 0:e.nodeValue)||"";if(this.el.id===n){this.debouncedGlobalClick(i)}}return[2]}))}))};t.prototype.listenOnKeyDown=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(this.activeClosable&&this.presented&&isEscapeKey(t)){stopEventBubbling(t);this.dismiss()}return[2]}))}))};t.prototype.listenOnMouseDown=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.isClickedOutsideOnMouseDown=this.onBackdropClick(t);return[2]}))}))};t.prototype.listenOnMouseUp=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.isClickedOutsideOnMouseUp=this.onBackdropClick(t);return[2]}))}))};t.prototype.listenOnComponentClick=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!(this.presented&&this.activeBackdropDismiss&&this.isClickedOutsideOnMouseUp&&this.isClickedOutsideOnMouseDown))return[3,2];return[4,this.dismiss()];case 1:t.sent();t.label=2;case 2:return[2]}}))}))};t.prototype.present=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.resetAllVariants()];case 1:t.sent();return[4,this._present()];case 2:if(t.sent()){this.lastTrigger=this.trigger;this.balChange.emit(this.presented)}return[2]}}))}))};t.prototype.dismiss=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.resetAllVariants()];case 1:t.sent();return[4,this._dismiss()];case 2:if(t.sent()){this.lastTrigger=this.trigger;this.balChange.emit(this.presented)}return[2]}}))}))};t.prototype.toggle=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.presented){return[2,this.dismiss()]}else{return[2,this.present()]}return[2]}))}))};t.prototype.setMinWidth=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){if(this.containerEl){this.containerEl.style.minWidth="".concat(t,"px");this.minContainerWidth=t}return[2]}))}))};t.prototype._emitChange=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.balChange.emit(this.presented);return[2]}))}))};t.prototype._present=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:if(balBrowser.hasDocument){this.lastFocus=document.activeElement||undefined}if(!this.lastVariantRenderer)return[3,2];return[4,this.lastVariantRenderer.dismiss(this)];case 1:e.sent();this.presented=true;e.label=2;case 2:this.lastVariantRenderer=this.getVariantRenderer();return[4,this.lastVariantRenderer.present(this)];case 3:t=e.sent();this.focusFirstDescendant();return[2,t]}}))}))};t.prototype._dismiss=function(){return __awaiter(this,void 0,void 0,(function(){var t,e;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.getVariantRenderer().dismiss(this)];case 1:e=r.sent();this.lastVariantRenderer=undefined;if(this.lastFocus&&this.lastFocus.focus){(t=this.lastFocus)===null||t===void 0?void 0:t.focus()}return[2,e]}}))}))};t.prototype.getVariantRenderer=function(t){if(t===void 0){t=this.activeVariant}switch(t){case"fullscreen":return this.fullscreenVariantRenderer;case"drawer":return this.drawerVariantRenderer;default:return this.popoverVariantRenderer}};t.prototype.getValue=function(t,e,r){var i=t.attributes.getNamedItem(e);return i?i.value:r};t.prototype.getNumberValue=function(t,e,r){var i=t.attributes.getNamedItem(e);if(i){return parseInt(i.value,10)||r}return r};t.prototype.getBooleanValue=function(t,e,r){var i=t.attributes.getNamedItem(e);if(i){var n=i.value===""||i.value==="true"?true:false;return i?n:r}return r};t.prototype.notifyGlobalClick=function(t){this.trigger=t;this.lastTrigger=this.lastTrigger===undefined?this.trigger:this.lastTrigger;this.activeVariant=this.getValue(t,"bal-popup-variant",this.variant);this.activeClosable=this.getBooleanValue(t,"bal-popup-closable",this.closable);this.activeBackdropDismiss=this.getBooleanValue(t,"bal-popup-backdrop-dismiss",this.backdropDismiss);if(this.presented&&this.lastTrigger!==this.trigger){this._present();this.lastTrigger=this.trigger}else{this.toggle()}};t.prototype.resetAllVariants=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){switch(e.label){case 0:return[4,this.dismissAllOtherPopups()];case 1:e.sent();if(!(this.lastVariant!==this.activeVariant))return[3,3];t=this.getVariantRenderer(this.lastVariant);return[4,t.dismiss(this)];case 2:e.sent();e.label=3;case 3:this.lastVariant=this.activeVariant;return[2]}}))}))};t.prototype.dismissAllOtherPopups=function(){return __awaiter(this,void 0,void 0,(function(){var t,e,r;var i=this;return __generator(this,(function(n){switch(n.label){case 0:if(!balBrowser.hasDocument)return[3,5];t=Array.from(document.getElementsByTagName("bal-popup")).filter((function(t){return t.id!==i.el.id&&t.ariaHidden!=="true"}));e=0;n.label=1;case 1:if(!(e<t.length))return[3,5];r=t[e];return[4,r._dismiss()];case 2:n.sent();return[4,r._emitChange()];case 3:n.sent();n.label=4;case 4:e++;return[3,1];case 5:return[2]}}))}))};t.prototype.focusFirstDescendant=function(){var t=this.el;var e=t.querySelector(focusableQueryString);if(e){e.focus()}else{t.focus()}};t.prototype.render=function(){var t=this;var e=BEM.block("popup");var r=e.element("container");var i=e.element("arrow");var n=e.element("backdrop");var a=e.element("inner");var o=a.element("head");var s=a.element("content");return h(Host,{class:Object.assign({},e.class()),role:"dialog","aria-hidden":"".concat(this.presented!==true),"aria-modal":"".concat(this.presented===true),"aria-presented":"".concat(this.presented===true),"aria-labelledby":"".concat(this.popupId,"-heading")},h("div",{class:Object.assign({},n.class()),ref:function(e){return t.backdropEl=e}}),h("div",{class:Object.assign(Object.assign({},r.class()),r.modifier("variant-".concat(this.activeVariant)).class()),ref:function(e){return t.containerEl=e},style:{minWidth:"".concat(this.minContainerWidth,"px")}},h("div",{class:Object.assign({},i.class()),ref:function(e){return t.arrowEl=e}}),h("bal-stack",{layout:"vertical",px:this.activeVariant==="popover"?"medium":"none",py:"medium",class:Object.assign({},a.class())},this.label?h("bal-stack",{space:"auto",class:Object.assign({},o.class())},h("bal-heading",{"data-test":"bal-popup-label",level:"span","visual-level":"large",id:"".concat(this.popupId,"-heading")},this.label),this.activeClosable?h("bal-close",{"data-test":"bal-popup-close",tabindex:-1,onClick:function(){return t.onCloseClick()}}):""):"",h("div",{class:Object.assign({},s.class()),ref:function(e){return t.contentEl=e},"data-test":"bal-popup-content"},h("slot",null)))))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{variant:["variantChanged"],active:["activeChanged"],contentWidth:["contentWidthChanged"]}},enumerable:false,configurable:true});return t}();__decorate([Logger("bal-popup")],Popup.prototype,"createLogger",null);var popupIds=0;Popup.style={css:balPopupCss};export{Popup as bal_popup};