import{__awaiter,__generator}from"tslib";import{r as registerInstance,c as createEvent,h,H as Host,g as getElement}from"./index-853c3f3f.js";import{c as isSpaceKey}from"./index.esm-586fc0cd.js";import{a as autoUpdate,c as computePosition,o as offset,f as flip}from"./floating-ui.dom.esm-fd52c63a.js";import{B as BalDate,i as i18nBalDate}from"./date-daa101cf.js";import{B as BEM}from"./bem-1b28532d.js";import{L as Logger}from"./log-01623e2c.js";import{i as inheritAttributes}from"./attributes-56afda45.js";import{s as stopEventBubbling}from"./form-input-8e4d0215.js";import{d as defaultConfig}from"./initialize-ac68e3e3.js";import{L as ListenToConfig}from"./config.decorator-54721e29.js";import{m as debounceEvent}from"./helpers-697ce790.js";import{d as defaultBalAriaForm}from"./form-479fd066.js";import"./index-82aff103.js";import"./_commonjsHelpers-ba3f0406.js";import"./index-8b8ed6bd.js";import"./browser-9199b5e2.js";import"./icons.constant-0d61e703.js";var balDateCss=":root{--bal-date-popup-z-index:var(--bal-z-index-tooltip);--bal-date-popup-shadow:var(--bal-shadow-normal);--bal-date-popup-radius:var(--bal-radius-normal)}:root{--bal-z-index-tooltip:1300}.bal-date{display:block;font-family:var(--bal-font-family-text);width:100%}.bal-date__icon--clickable{cursor:pointer}.bal-date__popup{display:none;width:-webkit-max-content;width:-moz-max-content;width:max-content;position:absolute;top:0;left:0;z-index:var(--bal-date-popup-z-index);-webkit-box-shadow:var(--bal-date-popup-shadow);box-shadow:var(--bal-date-popup-shadow);border-radius:var(--bal-date-popup-radius)}.bal-date__popup--visible{display:block}";var __decorate=undefined&&undefined.__decorate||function(t,e,i,n){var a=arguments.length,r=a<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,i):n,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(t,e,i,n);else for(var s=t.length-1;s>=0;s--)if(o=t[s])r=(a<3?o(r):a>3?o(e,i,r):o(e,i))||r;return a>3&&r&&Object.defineProperty(e,i,r),r};var Date=function(){function t(t){var e=this;registerInstance(this,t);this.balInput=createEvent(this,"balInput",7);this.balChange=createEvent(this,"balChange",7);this.balWillAnimate=createEvent(this,"balWillAnimate",7);this.balDidAnimate=createEvent(this,"balDidAnimate",7);this.balBlur=createEvent(this,"balBlur",7);this.balFocus=createEvent(this,"balFocus",7);this.balInputClick=createEvent(this,"balInputClick",7);this.balIconClick=createEvent(this,"balIconClick",7);this.balPopoverPrepare=createEvent(this,"balPopoverPrepare",7);this.inputId="bal-da-".concat(dateIds++);this.inheritedAttributes={};this.onIconClick=function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!this.triggerIcon)return[3,2];return[4,this.toggle()];case 1:t.sent();return[3,4];case 2:return[4,this.open()];case 3:t.sent();t.label=4;case 4:return[2]}}))}))};this.onInputClick=function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!!this.triggerIcon)return[3,2];return[4,this.open()];case 1:t.sent();t.label=2;case 2:return[2]}}))}))};this.onCalendarChange=function(t){stopEventBubbling(t);e.value=t.detail;e.balChange.emit(e.value);if(e.closeOnSelect){e.close()}};this.onInputInput=function(t){stopEventBubbling(t);e.balInput.emit(t.detail);if(t.detail){var i=BalDate.fromAnyFormat(t.detail);if(i.isValid){e.calendarValue=i.toISODate()}}};this.onInputChange=function(t){stopEventBubbling(t);e.value=t.detail;e.balChange.emit(e.value)};this.onInputFocus=function(t){stopEventBubbling(t);e.balFocus.emit(t.detail)};this.onInputBlur=function(t){stopEventBubbling(t);e.balBlur.emit(t.detail)};this.onKeyPress=function(t){var i=t.detail;return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:if(!(isSpaceKey(i)&&!this.triggerIcon))return[3,4];if(!this.isExpanded)return[3,2];return[4,this.close()];case 1:t.sent();return[3,4];case 2:return[4,this.open()];case 3:t.sent();t.label=4;case 4:return[2]}}))}))};this.isExpanded=false;this.language=defaultConfig.language;this.calendarValue=undefined;this.ariaForm=defaultBalAriaForm;this.name=this.inputId;this.invalid=false;this.required=false;this.disabled=false;this.readonly=false;this.freeSolo=false;this.placeholder=undefined;this.triggerIcon=false;this.closeOnSelect=true;this.value=undefined;this.min=undefined;this.max=undefined;this.minYearProp=undefined;this.maxYearProp=undefined;this.defaultDate=undefined;this.allowedDates=undefined;this.debounce=0}t.prototype.createLogger=function(t){this.log=t};t.prototype.valueChanged=function(){this.calendarValue=this.value};t.prototype.debounceChanged=function(){this.balChange=debounceEvent(this.balChange,this.debounce)};t.prototype.connectedCallback=function(){this.valueChanged()};t.prototype.componentWillLoad=function(){this.inheritedAttributes=inheritAttributes(this.el,["aria-label","tabindex","title"])};t.prototype.listenToKeydown=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!(this.isExpanded&&(t.key==="Escape"||t.key==="Esc")))return[3,2];t.preventDefault();return[4,this.close()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))};t.prototype.listenOnKeyup=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!(t.key==="Tab"&&!this.el.contains(document.activeElement)&&this.isExpanded))return[3,2];return[4,this.close()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))};t.prototype.listenOnclick=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!(this.isExpanded&&!this.el.contains(t.target)))return[3,2];return[4,this.close()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))};t.prototype.listenOnPopoverPrepare=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:if(!(this.inputId!==t.detail))return[3,2];return[4,this.close()];case 1:e.sent();e.label=2;case 2:return[2]}}))}))};t.prototype.configChanged=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.language=t.language;return[2]}))}))};t.prototype.open=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.expand()]}))}))};t.prototype.close=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){return[2,this.collapse()]}))}))};t.prototype.toggle=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.isExpanded){return[2,this.collapse()]}else{return[2,this.expand()]}return[2]}))}))};t.prototype.select=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(i){e=BalDate.fromISO(t);if(e.isValid){this.value=e.toISODate();this.calendarValue=this.value}return[2]}))}))};t.prototype.setFocus=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){(t=this.inputEl)===null||t===void 0?void 0:t.setFocus();return[2]}))}))};t.prototype.setBlur=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){(t=this.inputEl)===null||t===void 0?void 0:t.setBlur();return[2]}))}))};t.prototype.getInputElement=function(){return __awaiter(this,void 0,void 0,(function(){var t;return __generator(this,(function(e){return[2,(t=this.inputEl)===null||t===void 0?void 0:t.getInputElement()]}))}))};t.prototype.setAriaForm=function(t){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(i){this.ariaForm=Object.assign({},t);(e=this.inputEl)===null||e===void 0?void 0:e.setAriaForm(t);return[2]}))}))};t.prototype.expand=function(){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(e){if(this.referenceEl&&this.floatingEl){this.balPopoverPrepare.emit(this.inputId);this.balWillAnimate.emit();this.isExpanded=true;this.popupCleanup=autoUpdate(this.referenceEl,this.floatingEl,(function(){t.updatePosition(t.referenceEl,t.floatingEl)}))}return[2,this.isExpanded]}))}))};t.prototype.collapse=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){if(this.floatingEl){this.balWillAnimate.emit();this.isExpanded=false;if(this.popupCleanup){this.popupCleanup()}this.balDidAnimate.emit()}return[2,this.isExpanded]}))}))};t.prototype.updatePosition=function(t,e){var i=this;computePosition(t,e,{placement:"bottom-start",middleware:[offset(4),flip({crossAxis:false})]}).then((function(t){var n=t.x,a=t.y;Object.assign(e.style,{left:"".concat(n,"px"),top:"".concat(a,"px")});i.balDidAnimate.emit()}))};t.prototype.render=function(){var t=this;var e=BEM.block("date");var i=e.element("icon");var n=e.element("popup");return h(Host,{id:this.inputId,class:Object.assign({},e.class())},h("bal-input-group",{invalid:this.invalid,readonly:this.readonly,disabled:this.disabled,ref:function(e){return t.referenceEl=e}},h("bal-input-date",Object.assign({required:this.required,placeholder:this.placeholder,value:this.value,invalid:this.invalid,readonly:this.readonly,disabled:this.disabled,onClick:this.onInputClick,onBalInput:this.onInputInput,onBalChange:this.onInputChange,onBalFocus:this.onInputFocus,onBalBlur:this.onInputBlur,onBalKeyPress:this.onKeyPress,ref:function(e){return t.inputEl=e}},this.inheritedAttributes)),!this.freeSolo?h("bal-icon",{name:"date",role:"button",tabindex:-1,class:Object.assign(Object.assign({},i.class()),i.modifier("clickable").class(!this.disabled&&!this.readonly)),"is-right":true,color:this.disabled||this.readonly?"grey":this.invalid?"danger":"primary",onClick:this.onIconClick,"aria-label":i18nBalDate[this.language].toggleDatepicker,"aria-haspopup":"true","aria-expanded":this.isExpanded?"true":"false"}):""),h("div",{role:"dialog",class:Object.assign(Object.assign({},n.class()),n.modifier("visible").class(this.isExpanded)),ref:function(e){return t.floatingEl=e},"aria-hidden":"".concat(this.isExpanded!==true),"aria-presented":"".concat(this.isExpanded===true)},h("bal-date-calendar",{value:this.calendarValue,min:this.min,max:this.max,minYearProp:this.minYearProp,maxYearProp:this.maxYearProp,defaultDate:this.defaultDate,allowedDates:this.allowedDates,onBalChange:this.onCalendarChange})))};Object.defineProperty(t.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{value:["valueChanged"],debounce:["debounceChanged"]}},enumerable:false,configurable:true});return t}();__decorate([Logger("bal-date")],Date.prototype,"createLogger",null);__decorate([ListenToConfig()],Date.prototype,"configChanged",null);var dateIds=0;Date.style=balDateCss;export{Date as bal_date};