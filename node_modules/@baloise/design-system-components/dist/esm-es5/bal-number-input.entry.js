import{__awaiter,__generator,__spreadArray}from"tslib";import{r as registerInstance,c as createEvent,h,H as Host,g as getElement}from"./index-853c3f3f.js";import{a as defaultLocale,d as defaultConfig}from"./initialize-ac68e3e3.js";import{L as Logger}from"./log-01623e2c.js";import{L as ListenToConfig}from"./config.decorator-54721e29.js";import{h as inputHandleClick,a as inputHandleHostClick,i as inputHandleFocus,e as inputHandleBlur,f as inputHandleChange,k as getUpcomingValue,s as stopEventBubbling,b as inputListenOnClick,j as inputHandleReset,c as inputSetFocus,d as inputSetBlur,l as getNativeInputValue}from"./form-input-8e4d0215.js";import{m as debounceEvent}from"./helpers-697ce790.js";import{i as inheritAttributes}from"./attributes-56afda45.js";import{g as useBalConfig}from"./index-8b8ed6bd.js";import{j as getDecimalSeparator$1,k as getThousandSeparator$1,h as formatLocaleNumber$1}from"./index.esm-586fc0cd.js";import{B as BEM}from"./bem-1b28532d.js";import{d as defaultBalAriaForm}from"./form-479fd066.js";import{l as lodash_isnil}from"./index-82aff103.js";import{N as NUMBER_KEYS,A as ACTION_KEYS}from"./keys.constant-a195c4b1.js";import{l as lodash_isempty}from"./index-14bbb131.js";import"./browser-9199b5e2.js";import"./icons.constant-0d61e703.js";import"./_commonjsHelpers-ba3f0406.js";var numberTag="[object Number]";var objectProto=Object.prototype;var objectToString=objectProto.toString;function isObjectLike(e){return!!e&&typeof e=="object"}function isNaN(e){return isNumber$1(e)&&e!=+e}function isNumber$1(e){return typeof e=="number"||isObjectLike(e)&&objectToString.call(e)==numberTag}var lodash_isnan=isNaN;var getLocale=function(){var e=useBalConfig();return e&&e.locale||defaultLocale};var getDecimalSeparator=function(){return getDecimalSeparator$1(getLocale())};var getThousandSeparator=function(){return getThousandSeparator$1(getLocale())};var formatLocaleNumber=function(e,t){return formatLocaleNumber$1(getLocale(),e,t)};var getNegativeSymbol=function(){return"-"};function isNumber(e){var t=parseFloat(e);return typeof t==="number"&&!lodash_isnan(t)}function isNotNumber(e){return!isNumber(e)&&e!==""&&e!==getNegativeSymbol()&&e!==getDecimalSeparator()}function toNumber(e,t){if(t===void 0){t=0}if(e===""||e===undefined||e===null||lodash_isnan(e)||e===getNegativeSymbol()||e===getDecimalSeparator()||!isNumber(e)){return undefined}return t===0?parseInt(e,10):parseFloat(e)}function toFixedNumber(e,t){if(t===void 0){t=0}if(lodash_isnil(e)){return""}if(e.charAt(0)===getDecimalSeparator()){e="0".concat(e)}var i=t===0?parseInt(e,10):parseFloat(e);return lodash_isnan(i)?"":i.toFixed(t)}function mapDecimalSeparator(e){return e.replace(".",getDecimalSeparator())}function toUserFormattedNumber(e,t,i){if(t===void 0){t=0}if(i===void 0){i=""}if(lodash_isnil(e)){return""}if(e.charAt(0)===getDecimalSeparator()){e="0".concat(e)}var a=t===0?parseInt(e,10):parseFloat(e);var n=i!==""?" ".concat(i.trim()):"";return lodash_isnan(a)?"":formatLocaleNumber(a,t)+n}var countDecimalSeparators=function(e){return(e.split(getDecimalSeparator())||[]).length-1||0};function validateKeyDown(e){var t=e.key,i=e.selectionStart,a=e.selectionEnd,n=e.newValue,r=e.decimal;if(t===getNegativeSymbol()&&i&&i>0&&a&&a>0){return false}if(t===getDecimalSeparator()){if(r===0){return false}else if(countDecimalSeparators(n)>1){return false}}if(!__spreadArray(__spreadArray(__spreadArray([],NUMBER_KEYS,true),ACTION_KEYS,true),[getDecimalSeparator(),getNegativeSymbol()],false).includes(t)){return false}if(r!==0&&n.includes(getDecimalSeparator())&&__spreadArray([],NUMBER_KEYS,true).includes(t)){var o=n.split(getDecimalSeparator());var s=o[o.length-1];if(s.length>r){return false}}return true}var balNumberInputCss=".bal-number-input{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:block;position:relative;-ms-flex:1;flex:1;-ms-flex-align:center;align-items:center;width:100%;padding:0;font-family:var(--bal-font-family-text)}";var __decorate=undefined&&undefined.__decorate||function(e,t,i,a){var n=arguments.length,r=n<3?t:a===null?a=Object.getOwnPropertyDescriptor(t,i):a,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(e,t,i,a);else for(var s=e.length-1;s>=0;s--)if(o=e[s])r=(n<3?o(r):n>3?o(t,i,r):o(t,i))||r;return n>3&&r&&Object.defineProperty(t,i,r),r};var NumberInput=function(){function e(e){var t=this;registerInstance(this,e);this.balInput=createEvent(this,"balInput",7);this.balChange=createEvent(this,"balChange",7);this.balBlur=createEvent(this,"balBlur",7);this.balFocus=createEvent(this,"balFocus",7);this.balKeyPress=createEvent(this,"balKeyPress",7);this.inputId="bal-number-input-".concat(numberInputIds++);this.inheritedAttributes={};this.lastValue="";this.inputValue=this.value;this.initialValue=undefined;this.onClick=function(e){return inputHandleClick(t,e)};this.handleClick=function(e){return inputHandleHostClick(t,e)};this.onInput=function(e){var i;if(t.nativeInput){if(isNotNumber(t.nativeInput.value)){t.nativeInputValue=t.lastValue||"";return}}t.lastValue=((i=t.nativeInput)===null||i===void 0?void 0:i.value)||"";t.balInput.emit(toNumber(t.lastValue,t.decimal))};this.onFocus=function(e){inputHandleFocus(t,e);if(t.nativeInput){t.nativeInputValue=mapDecimalSeparator(t.lastValue||"")}};this.onBlur=function(e){inputHandleBlur(t,e);if(t.nativeInput){t.lastValue=toFixedNumber(t.lastValueGetter,t.decimal);t.nativeInputValue=toUserFormattedNumber(t.lastValueGetter,t.decimal,t.suffix)}t.inputValue=toNumber(t.lastValueGetter,t.decimal);inputHandleChange(t)};this.onKeydown=function(e){var i=getNativeInputValue(t);var a=getUpcomingValue(t,e);var n=e===null||e===void 0?void 0:e.target;if(n&&!validateKeyDown({key:e.key,decimal:t.decimal,newValue:a,oldValue:i,selectionStart:n.selectionStart,selectionEnd:n.selectionEnd})){return stopEventBubbling(e)}};this.focused=false;this.language=defaultConfig.language;this.region=defaultConfig.region;this.ariaForm=defaultBalAriaForm;this.nativeInputValue="";this.inputPattern=this.createPattern();this.name=this.inputId;this.invalid=false;this.decimal=0;this.suffix=undefined;this.pattern=undefined;this.placeholder=undefined;this.required=false;this.disabled=false;this.readonly=false;this.exactNumber=false;this.max=undefined;this.min=undefined;this.debounce=0;this.value=undefined}e.prototype.createLogger=function(e){this.log=e};e.prototype.debounceChanged=function(){this.balChange=debounceEvent(this.balChange,this.debounce)};e.prototype.valueChanged=function(e,t){if(e!==t){var i=e===""||lodash_isnil(e)||lodash_isnan(e);var a=this.exactNumber?"0":"";var n=i?a:e.toString();this.inputValue=toNumber(toFixedNumber(n,this.decimal),this.decimal);this.lastValue=toFixedNumber(n,this.decimal);if(this.focused){this.nativeInputValue=mapDecimalSeparator(this.lastValue)}else{this.nativeInputValue=toUserFormattedNumber(this.lastValue,this.decimal,this.suffix)}}};e.prototype.connectedCallback=function(){this.debounceChanged();this.initialValue=this.value||0;if(this.value!==undefined){this.valueChanged(this.value,undefined)}};e.prototype.componentDidLoad=function(){this.inputValue=this.value};e.prototype.componentWillLoad=function(){this.inheritedAttributes=inheritAttributes(this.el,["aria-label","tabindex","title"])};e.prototype.listenOnClick=function(e){inputListenOnClick(this,e)};e.prototype.resetHandler=function(e){var t=e.target;if(t===null||t===void 0?void 0:t.contains(this.el)){inputHandleReset(this,this.initialValue,this.resetHandlerTimer)}};e.prototype.configChanged=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.language=e.language;this.region=e.region;this.inputPattern=this.createPattern();if(this.nativeInput){if(this.focused){this.nativeInputValue=mapDecimalSeparator(this.lastValue)}else{this.nativeInputValue=toUserFormattedNumber(this.lastValue,this.decimal,this.suffix)}}return[2]}))}))};e.prototype.setFocus=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){inputSetFocus(this);return[2]}))}))};e.prototype.setBlur=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){inputSetBlur(this);return[2]}))}))};e.prototype.getInputElement=function(){return Promise.resolve(this.nativeInput)};e.prototype.setAriaForm=function(e){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.ariaForm=Object.assign({},e);return[2]}))}))};e.prototype.createPattern=function(){if(this.pattern){return this.pattern}var e=this.suffix||"";if(e!==""){e=" ".concat(e)}var t=getThousandSeparator();var i=getDecimalSeparator();if(i===","){i="\\,"}return"-?\\d{1,3}(?:".concat(t,"\\d{3})*(?:\\").concat(i,"\\d{1,2})?(?:").concat(e,")?")};Object.defineProperty(e.prototype,"lastValueGetter",{get:function(){if(this.exactNumber&&(lodash_isnil(this.lastValue)||lodash_isempty(this.lastValue))){return"0"}return this.lastValue},enumerable:false,configurable:true});e.prototype.render=function(){var e=this;var t=BEM.block("number-input");return h(Host,{onClick:this.handleClick,"aria-disabled":this.disabled?"true":null,class:Object.assign({},t.class())},h("input",Object.assign({class:{input:true,"is-disabled":this.disabled||this.readonly,"is-danger":this.invalid},"data-testid":"bal-number-input",ref:function(t){return e.nativeInput=t},id:this.ariaForm.controlId||this.inputId,"aria-labelledby":this.ariaForm.labelId,"aria-describedby":this.ariaForm.messageId,"aria-invalid":this.invalid===true?"true":"false","aria-disabled":this.disabled?"true":null,name:this.name,disabled:this.disabled,placeholder:this.placeholder||"",readonly:this.readonly,required:this.required,pattern:this.inputPattern,min:this.min,max:this.max,value:this.nativeInputValue,onInput:function(t){return e.onInput(t)},onFocus:function(t){return e.onFocus(t)},onBlur:function(t){return e.onBlur(t)},onClick:this.onClick,onKeyDown:function(t){return e.onKeydown(t)},onKeyPress:function(t){return e.balKeyPress.emit(t)}},this.inheritedAttributes)))};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{debounce:["debounceChanged"],value:["valueChanged"]}},enumerable:false,configurable:true});return e}();__decorate([Logger("bal-number-input")],NumberInput.prototype,"createLogger",null);__decorate([ListenToConfig()],NumberInput.prototype,"configChanged",null);var numberInputIds=0;NumberInput.style={css:balNumberInputCss};export{NumberInput as bal_number_input};